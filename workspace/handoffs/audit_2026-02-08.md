# Audit 2026-02-08

## Scope
Full system audit (architecture, agents, routing, budgets, logs, failure points).

## Architecture Summary
- **Core runtime**: OpenClaw gateway + agent orchestration via `openclaw.json`.
- **Pipelines**: ITC ingest → normalize → classify → digest; market fetch → sim → economics rollup (see `pipelines/system1_trading.yaml`, `scripts/run_cycle.py`).
- **Data stores**: `itc/` JSONL, `market/` candles, `sim/` state + trades, `economics/` ledger.

## Agents & Routing
- **Agents**: `main` (Qwen), `claude-code` (Anthropic) per `openclaw.json`.
- **Default agent model**: `qwen-portal/coder-model` with fallbacks `qwen-portal/vision-model`, `ollama/qwen14b-tools-32k`.
- **Classifier routing**: `scripts/itc_classify.py` uses Groq → Qwen Portal → Ollama → rules-only.
- **Cron**: 5 jobs defined in `cron/jobs.json` (2x Telegram checks, 1x regression, 1x ITC refresh, 1x daily digest).

## Budgets / Governance
- **Trading governance**: max daily loss 3%, max drawdown 15%, max trades/day 30 (see `scripts/sim_runner.py`).
- **Token budget**: no enforced budget policy found for LLM usage (only implicit limits like `--max-llm`).

## Logs & Observed Failures
- **Anthropic 404**: claude-code sessions show repeated `404 Not Found` for Anthropic API requests.
- **Qwen rate limit**: repeated `429 Free allocated quota exceeded` errors in main agent sessions.
- **Groq TPM**: `413 Request too large` on Groq model when used for agent-sized prompts.
- **Ollama 404**: `404 page not found` errors when hitting local Ollama in prior fallbacks.
- **Telegram send**: `chat not found` errors when targeting `@r3spond3rbot` (missing chat/DM init or wrong target).

## Failure Points / Risks
- **Secrets in tracked configs**: Groq API key present in tracked model configs (security policy violation).
- **Provider config drift**: Groq enabled in agent models despite policy to exclude from agent path.
- **Ollama baseUrl mismatch**: claude-code model config lacks `/v1` baseUrl (causes 404).
- **No token budget enforcement**: rate limits are reactive; system doesn’t pre-budget or throttle.
- **Intent failure visibility**: failures are logged but not surfaced with concrete remediation guidance.

## Recommended Remediations (Design Briefs Required)
1. Remove all secrets from tracked files; move to `secrets.env` only.
2. Align provider enablement (disable Groq for agent routing; keep for classifier only).
3. Fix claude-code Ollama baseUrl to `/v1`.
4. Add enforced token-budget + routing policy for LLM calls.
5. Add intent-failure detection/reporting with suggested fixes.


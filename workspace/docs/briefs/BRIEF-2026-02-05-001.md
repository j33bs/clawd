# Change Brief: Telegram MTProto Ingestion via Telethon

## Metadata
- **ID**: BRIEF-2026-02-05-001
- **Category**: C (Feature)
- **Author**: Claude Opus
- **Date**: 2026-02-05
- **Branch**: feature/telegram-telethon-ingestion

---

## Summary

Implement Telegram message ingestion for the ITC Pipeline using Telethon (MTProto user-session). This enables reading from private groups/chats that Bot API cannot access, with a strict allowlist gate to ensure only specified ITC-related chats are processed.

---

## Motivation

The ITC Pipeline requires ingestion of content from private Telegram groups:
- ITC Lifetime Lounge
- Into the Cryptoverse Chat (Private)
- Into the Cryptoverse Alerts (Private)
- Into The Cryptocosm Alerts (Private)

Bot API cannot access private groups without being explicitly added. A user-session via MTProto (Telethon) enables passive reading of any chat the authenticated user belongs to.

---

## Risk Assessment

### Reversibility
- [x] Easy - Can revert with single commit
- [ ] Moderate - Requires multiple steps to revert
- [ ] Hard - May have cascading effects

All new files are isolated in `workspace/itc_pipeline/` and `workspace/scripts/itc/`. Removal does not affect existing functionality.

### Blast Radius
- `workspace/itc_pipeline/` (new directory)
- `workspace/scripts/itc/` (new directory)
- `secrets.env.template` (addition only)
- `.gitignore` (addition only)
- `telegram/` (new runtime files, gitignored)

### Security Impact
- [x] Medium - Security review required

**Security considerations:**
1. Telethon session file contains authentication material (mitigated: stored in `.secrets/`, gitignored)
2. Allowlist gate is HARD - enforced at ingestion boundary, cannot be bypassed
3. Environment variables for credentials (not hardcoded)
4. Exclusion patterns block internal/bot chatter

---

## Files Touched

| File | Action | Rationale |
|------|--------|-----------|
| `workspace/itc_pipeline/__init__.py` | CREATE | Module initialization |
| `workspace/itc_pipeline/allowlist.py` | CREATE | Hard allowlist gate by chat_id |
| `workspace/itc_pipeline/ingestion_boundary.py` | CREATE | Pipeline entry point with dedupe |
| `workspace/itc_pipeline/telegram_reader_telethon.py` | CREATE | Telethon-based message reader |
| `workspace/scripts/itc/telegram_list_dialogs.py` | CREATE | Chat ID discovery utility |
| `secrets.env.template` | MODIFY | Add TG_API_ID, TG_API_HASH, etc. |
| `.gitignore` | MODIFY | Add .session, .secrets/, itc_*.json |

---

## Implementation Plan

1. Create `itc_pipeline/` module structure
2. Implement allowlist gate (`allowlist.py`)
3. Implement ingestion boundary with dedupe (`ingestion_boundary.py`)
4. Implement Telethon reader (`telegram_reader_telethon.py`)
5. Create dialog listing script (`telegram_list_dialogs.py`)
6. Update secrets template and gitignore
7. Document verification procedures

---

## Rollback Plan

To rollback:
```bash
# Remove new directories
rm -rf workspace/itc_pipeline
rm -rf workspace/scripts/itc

# Revert secrets.env.template and .gitignore changes
git checkout -- secrets.env.template .gitignore

# Remove runtime files (if created)
rm -f telegram/itc_*.json telegram/itc_*.jsonl
rm -rf tmp/telegram_dialogs.tsv
rm -rf .secrets/
```

Or use git:
```bash
git revert <commit-hash>
```

---

## Regression Scope

### Automated Validation
- [x] Must pass: `scripts/regression.sh`
- [x] Must pass: `scripts/verify.sh`

### Manual Checks
- [ ] Telethon authentication completes successfully
- [ ] Dialog listing script outputs chat IDs
- [ ] Allowlist blocks non-allowed chats (debug log)
- [ ] Allowlist accepts allowed chats (info log)
- [ ] Dedupe prevents duplicate processing
- [ ] Dry-run mode logs without forwarding

---

## Admission Checklist

- [x] Brief complete with all sections filled
- [x] Branch created with correct prefix (or will be)
- [x] Implementation follows existing patterns
- [ ] Regression validation passed
- [x] No secrets in diff
- [x] Category/branch aligned
- [ ] Governance log entry prepared

---

## Notes

### Target Chat IDs
Must be discovered by running `telegram_list_dialogs.py` after authentication. The names below are for identification only:
- ITC Lifetime Lounge
- Into the Cryptoverse Chat (Private)
- Into the Cryptoverse Alerts (Private)
- Into The Cryptocosm Alerts (Private)

### Exclusions
Never ingest from:
- responder, Mbresponder/Mresponder, BotFather
- Any bot or internal system chat

### Future Work
- Tier classification (PRIMARY/OFFICIAL/COMMUNITY) based on content analysis
- Integration with existing ITC digest format
- Real-time vs batch processing options

---

*Template version: 1.0*
*See CONTRIBUTING.md for category definitions and admission process.*

# Teammate Auto-Ingest: Allowlisted `core/integration/**` (Gated)

## Problem / Failure Mode
- Preflight previously STOPped on untracked drift when model-created code showed up as untracked (example: `core/integration/econ_adapter.js`).
- Governance root docs at repo root are already handled by the existing "exact-set auto-ingest" rule:
  - `AGENTS.md BOOTSTRAP.md HEARTBEAT.md IDENTITY.md SOUL.md TOOLS.md USER.md`

## What Changed
- Preflight now has a second stage after the governance root-doc ingest:
  - Treats untracked allowlisted code files as "teammate input".
  - Evaluates them with safety gates.
  - Auto-integrates only when gates pass.

## Allowlist (Current)
- Only these untracked paths are eligible:
  - `core/integration/**/*.js`
  - `core/integration/**/*.mjs`
  - `core/integration/**/*.ts`
- Everything else untracked still triggers: `STOP (unrelated workspace drift detected)`.

## Safety Gates (Fail-Closed)
- Must be a regular file (no directories, no symlinks).
- Size <= 256 KB.
- Reject binary content via NUL-byte heuristic.
- Token-like scan:
  - Fails closed and reports only rule IDs, never matched strings.

## Integration Flow (When Eligible)
- Creates a topic branch: `teammate/ingest-YYYYMMDD-HHMMSS`
- Stages allowlisted files
- Runs gates:
  - `python3 -m unittest -q`
  - `npm test`
  - (Tests can skip these via env for harnesses only)
- If gates pass:
  - Commits with message:
    - `chore(teammate): ingest untracked allowlisted files (auto-gated)`
- If any gate fails:
  - Unstages and quarantines to `/tmp/openclaw-quarantine-<ts>/...`
  - STOPs non-zero with a short report.

## Operator Notes
- This is intentionally narrow: only `core/integration/**` is allowed today.
- To extend later, update the allowlist constants in `workspace/scripts/preflight_check.py` and add a deterministic unit test first.

## Revert
- Revert the governance change commit via `git revert <hash>`.

